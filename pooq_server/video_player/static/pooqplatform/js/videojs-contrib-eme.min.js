/**
 * videojs-contrib-eme
 * @version 2.0.1
 * @copyright 2018 
 * @license Apache-2.0
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.videojsContribEme=e()}}(function(){return function e(t,n,r){function i(a,d){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!d&&s)return s(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var f=n[a]={exports:{}};t[a][0].call(f.exports,function(e){var n=t[a][1][e];return i(n||e)},f,f.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){(function(e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t="undefined"!=typeof window?window.videojs:void 0!==e?e.videojs:null,r=function(e){return e&&e.__esModule?e:{default:e}}(t),i=function(e){var t=(e.video,e.keySystems),n=void 0;return Object.keys(t).forEach(function(e){var r={},i=t[e].audioContentType,o=t[e].videoContentType;i&&(r.audioCapabilities=[{contentType:i}]),o&&(r.videoCapabilities=[{contentType:o}]),n=n?n.catch(function(t){return navigator.requestMediaKeySystemAccess(e,[r])}):navigator.requestMediaKeySystemAccess(e,[r])}),n},o=function(e){var t=e.mediaKeys,n=e.initDataType,i=e.initData,o=e.options,a=e.getLicense,d=t.createSession();d.addEventListener("message",function(e){a(o,e.message).then(function(e){return d.update(e)}).catch(r.default.log.error.bind(r.default.log.error,"failed to get and set license"))},!1),d.generateRequest(n,i).catch(r.default.log.error.bind(r.default.log.error,"Unable to create or initialize key session"))},a=function(e){var t=e.video,n=e.initDataType,r=e.initData,i=e.options,a=e.getLicense;t.mediaKeysObject?o({mediaKeys:t.mediaKeysObject,initDataType:n,initData:r,options:i,getLicense:a}):t.pendingSessionData.push({initDataType:n,initData:r})},d=function(e){var t=e.video,n=e.certificate,r=e.createdMediaKeys,i=e.options,a=e.getLicense;t.mediaKeysObject=r,n&&r.setServerCertificate(n);for(var d=0;d<t.pendingSessionData.length;d++){var s=t.pendingSessionData[d];o({mediaKeys:t.mediaKeysObject,initDataType:s.initDataType,initData:s.initData,options:i,getLicense:a})}return t.pendingSessionData=[],t.setMediaKeys(r)},s=function(e){return function(t,n,i){r.default.xhr({uri:e,method:"POST",responseType:"arraybuffer",body:n,headers:{"Content-type":"application/octet-stream"}},function(e,t,n){if(e)return void i(e);i(null,n)})}},u=function(e){return function(t,n){return new Promise(function(r,i){e(t,n,function(e,t){e&&i(e),r(t)})})}},f=function(e){if("string"==typeof e&&(e={url:e}),!e.url&&!e.getLicense)throw new Error("Neither URL nor getLicense function provided to get license");return e.url&&!e.getLicense&&(e.getLicense=s(e.url)),e},c=function(e){var t=e.video,n=e.initDataType,o=e.initData,s=e.options;if(s&&s.keySystems){if(void 0===t.mediaKeysObject){var c=function(){t.mediaKeysObject=null,t.pendingSessionData=[];var e=void 0,n=void 0,o=i({video:t,keySystems:s.keySystems});if(!o)return r.default.log.error("No supported key system found"),{v:void 0};o.then(function(r){return new Promise(function(i,o){if(t.keySystem=r.keySystem,n=f(s.keySystems[r.keySystem]),!n.getCertificate)return void i(r);n.getCertificate(s,function(t,n){if(t)return void o(t);e=n,i(r)})})}).then(function(e){return e.createMediaKeys()}).then(function(r){return d({video:t,certificate:e,createdMediaKeys:r,options:s,getLicense:u(n.getLicense)})}).catch(r.default.log.error.bind(r.default.log.error,"Failed to create and initialize a MediaKeys object"))}();if("object"==typeof c)return c.v}a({video:t,initDataType:n,initData:o,options:s,getLicense:t.keySystem?u(f(s.keySystems[t.keySystem]).getLicense):null})}};n.standard5July2016=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){(function(r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var o="undefined"!=typeof window?window.videojs:void 0!==r?r.videojs:null,a=i(o),d=e("global/window"),s=i(d),u=e("./utils"),f=function(e){var t=e.initData,n=e.id,r=e.cert;"string"==typeof n&&(n=(0,u.stringToUint16Array)(n));var i=0,o=new ArrayBuffer(t.byteLength+4+n.byteLength+4+r.byteLength),a=new DataView(o);new Uint8Array(o,i,t.byteLength).set(t),i+=t.byteLength,a.setUint32(i,n.byteLength,!0),i+=4;var d=new Uint16Array(o,i,n.length);return d.set(n),i+=d.byteLength,a.setUint32(i,r.byteLength,!0),i+=4,new Uint8Array(o,i,r.byteLength).set(r),new Uint8Array(o,0,o.byteLength)},c=function(e){var t=e.video,n=e.contentId,r=e.initData,i=e.cert,o=e.options,a=e.getLicense;return new Promise(function(e,d){if(t.webkitKeys||t.webkitSetMediaKeys(new s.default.WebKitMediaKeys("com.apple.fps.1_0")),!t.webkitKeys)return void d("Could not create MediaKeys");var u=t.webkitKeys.createSession("application/x-mpegURL",f({id:n,initData:r,cert:i}));if(!u)return void d("Could not create key session");u.contentId=n,u.addEventListener("webkitkeymessage",function(e){a(o,n,e.message,function(e,t){if(e)return void d(e);for(var n=String.fromCharCode.apply(null,new Uint8Array(t)),r=s.default.atob(n),i=r.length,o=new Uint8Array(new ArrayBuffer(i)),a=0;a<i;a++)o[a]=r.charCodeAt(a);u.update(o)})}),u.addEventListener("webkitkeyadded",function(t){e(t)}),u.addEventListener("webkitkeyerror",function(e){d(e)})})},l=function(e){return function(t,n){a.default.xhr({uri:e,responseType:"arraybuffer"},function(e,t,r){if(e)return void n(e);for(var i=String.fromCharCode.apply(null,new Uint8Array(r)),o=s.default.atob(i),a=o.length,d=new Uint8Array(new ArrayBuffer(a)),u=0;u<a;u++)d[u]=o.charCodeAt(u);n(null,d)})}},y=function(e,t){return(0,u.getHostnameFromUri)((0,u.uint8ArrayToString)(t))},p=function(t,n){return function(r,i,o,d){var u=n||new Object;u["Content-type"]="application/x-www-form-urlencoded";var f=String.fromCharCode.apply(null,new Uint8Array(o.buffer)),c=s.default.btoa(f),l=e("querystring"),y={spc:c,assetId:i};a.default.xhr({uri:t,method:"POST",responseType:"arraybuffer",body:l.stringify(y),headers:u},function(e,t,n){if(e)return void d(e);d(null,n)})}},g=function(e){var t=e.video,n=e.initData,r=e.options,i=r.keySystems["com.apple.fps.1_0"],o=i.getCertificate||l(i.certificateUri),d=i.getContentId||y,s=i.getLicense||p(i.licenseUri,i.httpRequestHeaders);return new Promise(function(e,t){o(r,function(n,r){if(n)return void t(n);e(r)})}).then(function(e){return c({video:t,contentId:d(r,n),initData:n,cert:e,options:r,getLicense:s})}).catch(a.default.log.error.bind(a.default.log.error))};n.default=g,t.exports=n.default}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./utils":4,"global/window":5,querystring:8}],3:[function(e,t,n){(function(t){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i="undefined"!=typeof window?window.videojs:void 0!==t?t.videojs:null,o=r(i),a=e("global/window"),d=r(a),s=function(e){var t=(new DOMParser).parseFromString(String.fromCharCode.apply(null,new Uint16Array(e)),"application/xml"),n=t.getElementsByTagName("HttpHeaders")[0],r={};if(n)for(var i=n.getElementsByTagName("name"),o=n.getElementsByTagName("value"),a=0;a<i.length;a++)r[i[a].childNodes[0].nodeValue]=o[a].childNodes[0].nodeValue;var s=t.getElementsByTagName("Challenge")[0],u=void 0;return s&&(u=d.default.atob(s.childNodes[0].nodeValue)),{headers:r,message:u}};n.getMessageContents=s;var u=function(e,t,n){var r=e.keySystems["com.microsoft.playready"];if("function"==typeof r.getKey)return void r.getKey(e,n.destinationURL,n.message.buffer,function(e,n){if(e)return void o.default.log.error("Unable to get key: "+e);t.update(n)});"string"==typeof r&&(r={url:r});var i=r.url||n.destinationURL,a=s(n.message.buffer),d=a.headers,u=a.message;o.default.xhr({uri:i,method:"post",headers:d,body:u,responseType:"arraybuffer"},function(e,n){if(e)return void o.default.log.error("Unable to request key from url: "+i);t.update(new Uint8Array(n.body))})};n.addKeyToSession=u;var f=function(e,t,n){var r=e.msKeys.createSession("video/mp4",t);if(!r)return void o.default.log.error("Could not create key session.");r.addEventListener("mskeymessage",function(e){u(n,r,e)}),r.addEventListener("mskeyerror",function(e){o.default.log.error("Unexpected key error from key session with code: "+r.error.code+" and systemCode: "+r.error.systemCode)})};n.createSession=f,n.default=function(e){var t=e.video,n=e.initData,r=e.options;if(!r.keySystems||!r.keySystems["com.microsoft.playready"])return void o.default.log.error("PlayReady key system options not provided to decrypt video");if(!t.msKeys){try{t.msSetMediaKeys(new d.default.MSMediaKeys("com.microsoft.playready"))}catch(e){return void o.default.log.error("Unable to create media keys for PlayReady key system. Error: "+e.message)}f(t,n,r)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"global/window":5}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){for(var t=new ArrayBuffer(2*e.length),n=new Uint16Array(t),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n};n.stringToUint16Array=r;var i=function(e){return String.fromCharCode.apply(null,new Uint16Array(e.buffer))};n.uint8ArrayToString=i;var o=function(e){var t=document.createElement("a");return t.href=e,t.hostname};n.getHostnameFromUri=o},{}],5:[function(e,t,n){(function(e){"undefined"!=typeof window?t.exports=window:void 0!==e?t.exports=e:"undefined"!=typeof self?t.exports=self:t.exports={}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,n,o){t=t||"&",n=n||"=";var a={};if("string"!=typeof e||0===e.length)return a;var d=/\+/g;e=e.split(t);var s=1e3;o&&"number"==typeof o.maxKeys&&(s=o.maxKeys);var u=e.length;s>0&&u>s&&(u=s);for(var f=0;f<u;++f){var c,l,y,p,g=e[f].replace(d,"%20"),v=g.indexOf(n);v>=0?(c=g.substr(0,v),l=g.substr(v+1)):(c=g,l=""),y=decodeURIComponent(c),p=decodeURIComponent(l),r(a,y)?i(a[y])?a[y].push(p):a[y]=[a[y],p]:a[y]=p}return a};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],7:[function(e,t,n){"use strict";function r(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var i=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,n,d){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?r(a(e),function(a){var d=encodeURIComponent(i(a))+n;return o(e[a])?r(e[a],function(e){return d+encodeURIComponent(i(e))}).join(t):d+encodeURIComponent(i(e[a]))}).join(t):d?encodeURIComponent(i(d))+n+encodeURIComponent(i(e)):""};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},a=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},{}],8:[function(e,t,n){"use strict";n.decode=n.parse=e("./decode"),n.encode=n.stringify=e("./encode")},{"./decode":6,"./encode":7}],9:[function(e,t,n){(function(r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var o="undefined"!=typeof window?window.videojs:void 0!==r?r.videojs:null,a=i(o),d=e("./eme"),s=e("./fairplay"),u=i(s),f=e("./ms-prefixed"),c=i(f),l=function(e,t){(0,d.standard5July2016)({video:e.target,initDataType:e.initDataType,initData:e.initData,options:t})},y=function(e,t){(0,u.default)({video:e.target,initData:e.initData,options:t})},p=function(e,t){(0,c.default)({video:e.target,initData:e.initData,options:t})},g=function(e,t){"video"===e.$(".vjs-tech").tagName.toLowerCase()&&(e.tech_.el_.addEventListener("encrypted",function(n){l(n,a.default.mergeOptions(t,e.currentSource()))}),e.tech_.el_.addEventListener("webkitneedkey",function(n){y(n,a.default.mergeOptions(t,e.currentSource()))}),e.tech_.el_.addEventListener("msneedkey",function(n){p(n,a.default.mergeOptions(t,e.currentSource()))}))},v=function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.ready(function(){g(e,a.default.mergeOptions({},t))}),this.eme.options=t};(a.default.registerPlugin||a.default.plugin)("eme",v),n.default=v,t.exports=n.default}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./eme":1,"./fairplay":2,"./ms-prefixed":3}]},{},[9])(9)});